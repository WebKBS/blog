---
title: Next.js와 nodemailer를 사용해서 이메일 보내는 방법 feat. 문의하기 form 폼
date: 2024-05-01
description: next js에서 nodemailer를 사용해서 이메일을 보내는 방법과 문의하기 폼을 만드는 방법을 알아봅니다.
published: true
tags:
  - Next.js
  - nodemailer
  - contact
thumbnail: './images/nodemailer-logo.png'
---

## Summary

웹사이트 제작시 간혹 문의하기 폼을 만들어야하는 경우가 있습니다. 이때 문의하기의 내용을 이메일로 받아볼 수 있도록 nodemailer를 사용해서 이메일을 보내는 방법을 알아보겠습니다.

비록 문의하기(contact us) 폼을 예시로 들었지만, nodemailer를 사용하면 회원가입 인증 이메일, 비밀번호 찾기 이메일 등 다양한 용도로 사용할 수 있습니다.

본 블로그에서는 Next.js와 nodemailer를 사용해서 이메일을 보내는 방법과 문의하기 폼을 만드는 방법을 알아보겠습니다.

> 이 글은 Next.js `app router`를 사용하고 `server action`과 `useFormState` `useFormStatus`를 사용합니다.

## 목차

1. [폼 UI 만들기](#1-폼-ui-만들기)
2. [nodemailer 설정하기](#2-nodemailer-설정하기)

<br />
## 1. 폼 UI 만들기

먼저 간단한 문의하기 폼을 만들어보겠습니다. 간단히 사용법을 알아보기 위해서 style은 최소화하였습니다.

```tsx title="components/Form.tsx"
const Form = () => {
  return (
    <form>
      <div className="flex flex-col gap-4">
        <div>
          <label htmlFor="name">이름: </label>
          <input type="text" id="name" name="name" placeholder="이름" />
        </div>
        <div>
          <label htmlFor="email">이메일: </label>
          <input type="email" id="email" name="email" placeholder="이메일" />
        </div>
        <div>
          <label htmlFor="subject">문의 내용: </label>
          <textarea placeholder="문의 내용" id="subject" name="subject" />
        </div>
      </div>
      <button type="submit">전송</button>
    </form>
  );
};
```

간단히 폼을 만들었습니다. 각 label과 id, name등을 설정해줍니다. next.js 서버액션을 사용하기 위해 name은 필수입니다.

이제 폼을 만들었으니, 이제 nodemailer를 사용해서 이메일을 보내는 방법을 알아보겠습니다.

<br />

## 2. nodemailer 설정하기

nodemailer를 사용하기 위해서는 먼저 nodemailer를 설치해야합니다.

```bash
npm install nodemailer
```

nodemailer를 설치했다면, 이제 nodemailer를 사용하기 위해 서버 액션 sendEmail 함수를 만들어보겠습니다.

```tsx title="lib/action.ts"
'use server';
export const sendEmail = async (prevState: any, formData: FormData) => {
  try {
    const { name, email, subject } = Object.fromEntries(formData);

    console.log(name, email, subject);
  } catch (error) {
    console.error(error);
  }
};
```

server action을 사용하기 위해서 파일 최상단에 `'use server'`를 추가해줍니다.

그리고 useFormState를 사용하기 위해 `FormData`를 사용합니다. `Object.fromEntries(formData)`를 사용해서 form data를 object로 변환합니다.

`Object.fromEntries(formData)`를 사용하지 않고 개별로 formData.get을 사용해도 됩니다.

```tsx title="lib/action.ts - 예시"
const name = formData.get('name');
const email = formData.get('email');
const subject = formData.get('subject');
```

많은 양의 form data를 사용할 때는 `Object.fromEntries(formData)`를 사용하는 것이 편리합니다.

이제 다시 Form 컴포넌트로 돌아가서 `useFormState`를 사용해서 form data를 가져오고, `sendEmail` 함수를 호출하도록 수정해보겠습니다.

```tsx title="components/Form.tsx" {1, 3, 4, 7, 10 } showLineNumbers
'use client';

import { sendEmail } from '@/lib/action';
import { useFormState } from 'react-dom';

const Form = () => {
  const [actionState, formAction] = useFormState(sendEmail, null);

  return (
    <form action={formAction}>
      {/* ... */}
      {/* 기존 내용과 동일, 생략 */}
    </form>
  );
};

export default Form;
```

useFormState는 클라이언트 컴포넌트에서 사용할 수 있습니다. `'use client'`를 파일 최상단에 추가해줍니다.

useFormState는 첫 번째 인자로 서버 액션 함수를, 두 번째 인자로 초기 상태를 받습니다.

useFormState의 자세한 내용은 <MDXLink title="React 공식문서 - useFormState" href="https://react.dev/reference/react/useActionState" /> 를 참고해주세요.

form action에 formAction을 추가해주면, form이 submit 될 때 sendEmail 함수가 호출됩니다.

이제 Form 데이터를 입력하고 전송 버튼을 누르면, sendEmail 함수가 호출되어 Form 데이터를 console에 출력합니다.

예시로 이름은 `홍길동`, 이메일은 `gildong@gmail.com`, 문의 내용은 `'안녕하세요 문의 드립니다'`를 입력하고 전송버튼을 클릭하였습니다. 이제 터미널의 console을 확인해 봅니다.

```bash title="console 예시"
홍길동 gildong@gmail.com 안녕하세요 문의 드립니다
```

터미널 콘솔에서 위와 같이 입력한 내용 Form 데이터가 출력되면 성공입니다.

이제 입력값을 받았으니 이제 nodemailer를 사용해서 이메일을 보내는 방법을 알아보겠습니다.
